<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Viewer</title>
<style>
body { background:#010; color:lime; font-family:monospace; }
button { margin:10px; padding:8px 14px; }
video { width:100%; max-height:80vh; background:black; }
</style>
</head>
<body>
<h2>Receptor</h2>
<button id="join">Unirse a la sesi√≥n</button>
<video id="remote" autoplay playsinline controls></video>
<script>
const ws = new WebSocket("wss://TU_SERVIDOR.onrender.com");
const localId = "viewer-" + Math.random().toString(36).slice(2,9);
let peer, senderId;

ws.onopen = ()=>ws.send(JSON.stringify({type:"hello", id: localId}));

document.querySelector("#join").onclick = ()=>{
  peer = new RTCPeerConnection();
  peer.ontrack = e=>{
    document.querySelector("#remote").srcObject = e.streams[0];
  };
  peer.onicecandidate = e=>{
    if(e.candidate) send({type:"candidate", to:senderId, from:localId, payload:e.candidate});
  };
};

ws.onmessage = async ({data})=>{
  const msg = JSON.parse(data);
  if(msg.type==="offer" && msg.payload){
    senderId = msg.from;
    await peer.setRemoteDescription(msg.payload);
    const answer = await peer.createAnswer();
    await peer.setLocalDescription(answer);
    send({type:"answer", to:senderId, from:localId, payload:answer});
  }
  if(msg.type==="candidate" && msg.payload && msg.from===senderId){
    await peer.addIceCandidate(msg.payload);
  }
};

function send(obj){ ws.send(JSON.stringify(obj)); }
</script>
</body>
</html>